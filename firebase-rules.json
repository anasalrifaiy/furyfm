{
  "rules": {
    "managers": {
      ".read": "auth != null",
      "$uid": {
        // Match history can be written by any authenticated user (match participants write to each other)
        "matchHistory": {
          "$historyId": {
            ".write": "auth != null"
          }
        },

        // League matches can be written by any authenticated user
        "leagueMatches": {
          "$opponentId": {
            ".write": "auth != null"
          }
        },

        // Stats fields that can be updated by match participants
        "wins": {
          ".write": "auth != null"
        },
        "draws": {
          ".write": "auth != null"
        },
        "losses": {
          ".write": "auth != null"
        },
        "leagueWins": {
          ".write": "auth != null"
        },
        "leagueDraws": {
          ".write": "auth != null"
        },
        "leagueLosses": {
          ".write": "auth != null"
        },
        "leaguePoints": {
          ".write": "auth != null"
        },
        "leagueGoalsFor": {
          ".write": "auth != null"
        },
        "leagueGoalsAgainst": {
          ".write": "auth != null"
        },

        // Notifications can be written by others (for sending challenges, etc.)
        "notifications": {
          ".read": "auth != null && auth.uid == $uid",
          "$notificationId": {
            ".write": "auth != null"
          }
        },

        // Protected fields - only owner can write
        "managerName": {
          ".write": "auth != null && auth.uid == $uid"
        },
        "budget": {
          ".write": "auth != null && auth.uid == $uid"
        },
        "squad": {
          ".write": "auth != null && auth.uid == $uid"
        },
        "formation": {
          ".write": "auth != null && auth.uid == $uid"
        },
        "friends": {
          ".write": "auth != null && auth.uid == $uid"
        },
        "email": {
          ".write": "auth != null && auth.uid == $uid"
        },
        "points": {
          ".write": "auth != null && auth.uid == $uid"
        },
        "coachingStaff": {
          ".write": "auth != null && auth.uid == $uid"
        },
        "facilities": {
          ".write": "auth != null && auth.uid == $uid"
        }
      }
    },

    "matches": {
      ".read": "auth != null",
      "$matchId": {
        ".write": "auth != null && (data.child('homeManager/uid').val() == auth.uid || data.child('awayManager/uid').val() == auth.uid || !data.exists())"
      }
    },

    "players": {
      // Players database can be read by authenticated users
      ".read": "auth != null",
      // Only write for initial setup or admin (you can manage separately)
      ".write": "auth != null"
    },

    "transferMarket": {
      // Anyone authenticated can read transfer market
      ".read": "auth != null",

      "$listingId": {
        // Anyone can write to create listings, or owner can update
        ".write": "auth != null"
      }
    },

    "market": {
      // Transfer market - anyone authenticated can read/write
      ".read": "auth != null",
      ".write": "auth != null"
    },

    "loans": {
      // Bank loans - anyone authenticated can read/write
      ".read": "auth != null",
      ".write": "auth != null"
    }
  }
}
